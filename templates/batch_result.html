{% extends "base.html" %}
{% block title %}Batch Prediction Results{% endblock %}

{% block content %}
<div class="fade-in mt-4">
    <div class="card shadow-lg border-0 p-4">
        <h3 class="text-center text-success mb-3">
            <i class="fas fa-table"></i> Batch Prediction Results
        </h3>

        {% for table in tables %}
        <div class="table-responsive">
            {{ table | safe }}
        </div>
        {% endfor %}

        {% if roc_data %}
        <h4 class="mt-5 text-primary">ROC Curve</h4>
        <canvas id="rocChart"></canvas>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script>
            const rocCtx = document.getElementById('rocChart').getContext('2d');
            new Chart(rocCtx, {
                type: 'line',
                data: {
                    labels: {{ roc_data.fpr | safe }},
                datasets: [{
                    label: 'True Positive Rate',
                    data: {{ roc_data.tpr | safe }},
                borderColor: 'blue',
                borderWidth: 2,
                fill: false
                    }]
                },
                options: {
                responsive: true,
                scales: {
                    x: { title: { display: true, text: 'False Positive Rate' } },
                    y: { title: { display: true, text: 'True Positive Rate' } }
                }
            }
            });
        </script>
        {% endif %}

        {% if cm_data %}
        <h4 class="mt-5 text-primary">Confusion Matrix</h4>
        <canvas id="cmChart" width="400" height="400"></canvas>
        <script>
            const cmCtx = document.getElementById('cmChart').getContext('2d');
            new Chart(cmCtx, {
                type: 'bar',
                data: {
                    labels: ['Predicted Negative', 'Predicted Positive'],
                    datasets: [
                        {
                            label: 'Actual Negative',
                            data: [{{ cm_data[0][0] }}, {{ cm_data[0][1] }}],
                backgroundColor: ['rgba(0,200,83,0.6)', 'rgba(255,193,7,0.6)']
            },
                {
                    label: 'Actual Positive',
                    data: [{{ cm_data[1][0] }}, {{ cm_data[1][1] }}],
                backgroundColor: ['rgba(244,67,54,0.6)', 'rgba(33,150,243,0.6)']
                        }
                    ]
                },
                options: {
                responsive: true,
                plugins: {
                    title: {
                        display: true,
                        text: 'Confusion Matrix Visualization',
                        font: { size: 16 }
                    },
                    legend: { position: 'bottom' }
                },
                scales: { y: { beginAtZero: true } }
            }
            });
        </script>
        {% endif %}

        <div class="text-center mt-4">
            <a href="{{ url_for('dashboard') }}" class="btn btn-outline-dark animate-btn">
                <i class="fas fa-home"></i> Back to Dashboard
            </a>
        </div>
    </div>
</div>
{% endblock %}